<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Mundane Fitness Pro</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Import Map -->
    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18.2.0",
            "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
            "lucide-react": "https://esm.sh/lucide-react@0.263.1"
        }
    }
    </script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        ::-webkit-scrollbar { width: 0px; background: transparent; }
        body { 
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
            overscroll-behavior-y: none;
        }
    </style>
</head>
<body class="bg-[#050505] text-white">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useRef, useMemo } from 'react';
        import { createRoot } from 'react-dom/client';
        import { 
          Play, Pause, Settings, X, Eye, Loader2, Shuffle,
          Calendar, Zap, Clock, Dumbbell, Volume2, VolumeX,
          SkipForward, SkipBack, Activity, Menu
        } from 'lucide-react';

        // ONE TIME ONLY: Clear assets for new generation batch
        const PROFILES = {
            man: {
                config: { restTime: 60, rounds: 3, setRestTime: 10 }, // Long rest, 3 sets
                assets: [
                    'incline_db_press', 'flat_db_press', 'incline_db_fly', 'flat_db_fly',
                    'seated_shoulder_press', 'chest_supported_row', 'one_arm_row',
                    'incline_bicep_curl', 'seated_bicep_curl', 'skull_crushers',
                    'db_pullover', 'bulgarian_split_squat', 'seated_rear_delt_fly',
                    'step_ups', 'spider_curl', 'overhead_tricep_ext', 'concentration_curl',
                    'bench_dips', 'prone_reverse_fly', 'prone_row', 'single_arm_incline_press',
                    'seated_shrugs', 'goblet_squat_bench', 'seated_calf_raise', 'arnold_press',
                    'lateral_raises', 'hammer_curls', 'romanian_deadlift_male', 'lunges_male'
                ],
                library: {
                    'incline_db_press': { name: "Incline DB Press", angle: "45째 Incline", instructions: "Press DBs up, meeting in center.", key: 'incline_db_press', muscle: "Upper Chest", duration: 75 },
                    'flat_db_press': { name: "Flat DB Press", angle: "Flat", instructions: "Press vertically from chest level.", key: 'flat_db_press', muscle: "Chest", duration: 75 },
                    'incline_db_fly': { name: "Incline DB Fly", angle: "45째 Incline", instructions: "Wide arc motion for upper chest stretch.", key: 'incline_db_fly', muscle: "Upper Chest", duration: 60 },
                    'flat_db_fly': { name: "Flat DB Fly", angle: "Flat", instructions: "Open wide, squeeze chest at top.", key: 'flat_db_fly', muscle: "Chest", duration: 60 },
                    'seated_shoulder_press': { name: "Seated Shoulder Press", angle: "Upright", instructions: "Press DBs overhead.", key: 'seated_shoulder_press', muscle: "Shoulders", duration: 75 },
                    'chest_supported_row': { name: "Chest Supported Row", angle: "Incline", instructions: "Lie face down, row DBs to hips.", key: 'chest_supported_row', muscle: "Back", duration: 75 },
                    'one_arm_row': { name: "One Arm Row", angle: "Flat Bench", instructions: "Support on bench, row one side.", key: 'one_arm_row', muscle: "Lats", duration: 75 },
                    'incline_bicep_curl': { name: "Incline Curl", angle: "45째 Incline", instructions: "Arms back, curl with biceps.", key: 'incline_bicep_curl', muscle: "Biceps", duration: 60 },
                    'seated_bicep_curl': { name: "Seated Curl", angle: "Upright", instructions: "Standard seated bicep curl.", key: 'seated_bicep_curl', muscle: "Biceps", duration: 60 },
                    'skull_crushers': { name: "DB Skullcrushers", angle: "Flat", instructions: "Lower DBs to ears, extend.", key: 'skull_crushers', muscle: "Triceps", duration: 60 },
                    'db_pullover': { name: "DB Pullover", angle: "Flat", instructions: "Arc DB behind head.", key: 'db_pullover', muscle: "Lats/Chest", duration: 60 },
                    'bulgarian_split_squat': { name: "Bulgarian Split Squat", angle: "Standing/Bench", instructions: "One foot back on bench, squat.", key: 'bulgarian_split_squat', muscle: "Quads/Glutes", duration: 90 },
                    'seated_rear_delt_fly': { name: "Seated Rear Fly", angle: "Seated", instructions: "Hinge forward, fly out to sides.", key: 'seated_rear_delt_fly', muscle: "Rear Delts", duration: 45 },
                    'step_ups': { name: "Step Ups", angle: "Standing/Bench", instructions: "Step up onto bench.", key: 'step_ups', muscle: "Legs", duration: 90 },
                    'spider_curl': { name: "Spider Curl", angle: "Incline Prone", instructions: "Prone on incline, curl forward.", key: 'spider_curl', muscle: "Biceps", duration: 60 },
                    'overhead_tricep_ext': { name: "Overhead Tricep Ext", angle: "Seated", instructions: "DB behind head, extend up.", key: 'overhead_tricep_ext', muscle: "Triceps", duration: 60 },
                    'concentration_curl': { name: "Concentration Curl", angle: "Seated", instructions: "Elbow on thigh, isolate bicep.", key: 'concentration_curl', muscle: "Biceps", duration: 60 },
                    'bench_dips': { name: "Bench Dips", angle: "Bench", instructions: "Hands on bench, lower body.", key: 'bench_dips', muscle: "Triceps", duration: 60 },
                    'prone_reverse_fly': { name: "Prone Reverse Fly", angle: "Incline Prone", instructions: "Face down, fly for rear delts.", key: 'prone_reverse_fly', muscle: "Rear Delts", duration: 60 },
                    'prone_row': { name: "Prone Row", angle: "Incline Prone", instructions: "Face down, row elbows back.", key: 'prone_row', muscle: "Back", duration: 75 },
                    'single_arm_incline_press': { name: "1-Arm Incline Press", angle: "Incline", instructions: "Press one side at a time.", key: 'single_arm_incline_press', muscle: "Chest", duration: 60 },
                    'seated_shrugs': { name: "Seated Shrugs", angle: "Upright", instructions: "Shrug shoulders to ears.", key: 'seated_shrugs', muscle: "Traps", duration: 60 },
                    'goblet_squat_bench': { name: "Goblet Squat to Bench", angle: "Standing/Bench", instructions: "Squat until touching bench.", key: 'goblet_squat_bench', muscle: "Quads", duration: 90 },
                    'seated_calf_raise': { name: "Seated Calf Raise", angle: "Seated", instructions: "DBs on knees, raise heels.", key: 'seated_calf_raise', muscle: "Calves", duration: 75 },
                    'arnold_press': { name: "Arnold Press", angle: "Seated", instructions: "Rotate palms as you press.", key: 'arnold_press', muscle: "Shoulders", duration: 75 },
                    'lateral_raises': { name: "DB Lateral Raises", angle: "Standing", instructions: "Raise arms to sides until parallel.", key: 'lateral_raises', muscle: "Side Delts", duration: 60 },
                    'hammer_curls': { name: "Hammer Curls", angle: "Standing", instructions: "Curl with neutral grip.", key: 'hammer_curls', muscle: "Biceps/Forearms", duration: 60 },
                    'romanian_deadlift_male': { name: "Romanian Deadlift", angle: "Standing", instructions: "Hinge hips back, keep legs straightish.", key: 'romanian_deadlift_male', muscle: "Hamstrings", duration: 75 },
                    'lunges_male': { name: "Walking Lunges", angle: "Standing", instructions: "Step forward, drop back knee.", key: 'lunges_male', muscle: "Legs", duration: 75 },
                    'cardio_walk': { name: "Rest / Walk", angle: "N/A", instructions: "Active recovery or rest.", key: 'cardio_walk', muscle: "Cardio", duration: 300 }
                },
                protocols: {
                    'Push A': ['incline_db_press', 'seated_shoulder_press', 'overhead_tricep_ext', 'bench_dips', 'flat_db_fly'],
                    'Push B': ['flat_db_press', 'arnold_press', 'skull_crushers', 'incline_db_fly', 'seated_shrugs'],
                    'Push C': ['seated_shoulder_press', 'incline_db_fly', 'bench_dips', 'seated_shrugs', 'flat_db_press'],
                    'Pull A': ['chest_supported_row', 'incline_bicep_curl', 'spider_curl', 'prone_reverse_fly', 'db_pullover'],
                    'Pull B': ['one_arm_row', 'seated_bicep_curl', 'concentration_curl', 'seated_rear_delt_fly', 'prone_row'],
                    'Pull C': ['one_arm_row', 'spider_curl', 'prone_reverse_fly', 'db_pullover', 'seated_bicep_curl'],
                    'Legs':   ['bulgarian_split_squat', 'goblet_squat_bench', 'step_ups', 'seated_calf_raise', 'cardio_walk'],
                    'Legs B': ['step_ups', 'bulgarian_split_squat', 'seated_calf_raise', 'goblet_squat_bench', 'cardio_walk'],
                    'Rest':   ['cardio_walk'] 
                },
                defaultSchedule: ['Push A', 'Pull A', 'Legs', 'Push B', 'Pull B', 'Push A', 'Rest']
            },
            woman: {
                config: { restTime: 30, rounds: 4, setRestTime: 10 }, // Short rest, 4 circuits
                assets: [
                    'goblet_squat_female', 'lunges_female', 'kneeling_pushups_female', 'one_arm_row_female', 'overhead_press_female',
                    'pelvic_tilts_female', 'dead_bug_female', 'bird_dog_female', 'glute_bridges_female', 'clamshells_female',
                    'wall_sit_female', 'scapular_slides_female', 'cat_cow_female', 'childs_pose_female', 'standing_knee_raise_female',
                    'romanian_deadlift_female', 'donkey_kicks_female', 'superman_female', 'side_lying_leg_lift_female', 'plank_female',
                    'side_plank_female', 'russian_twists_female', 'jumping_jacks_female', 'mountain_climbers_female', 'step_ups_female', 'squat_jumps_female'
                ],
                library: {
                   'goblet_squat_female': { name: "Goblet Squat", angle: "Standing", instructions: "Hold weight at chest, squat down.", key: 'goblet_squat_female', muscle: "Quads/Core", duration: 45 },
                   'kneeling_pushups_female': { name: "Modified Pushups", angle: "Floor", instructions: "Knees on mat, keep back straight.", key: 'kneeling_pushups_female', muscle: "Chest/Core", duration: 45 },
                   'one_arm_row_female': { name: "One Arm Row", angle: "Bench", instructions: "Support on bench, row weight to hip.", key: 'one_arm_row_female', muscle: "Back", duration: 45 },
                   'overhead_press_female': { name: "Seated Press", angle: "Seated", instructions: "Press weights overhead, core tight.", key: 'overhead_press_female', muscle: "Shoulders", duration: 45 },
                   'glute_bridges_female': { name: "Glute Bridges", angle: "Floor", instructions: "Lift hips, squeeze glutes at top.", key: 'glute_bridges_female', muscle: "Glutes/Core", duration: 45 },
                   
                   'standing_knee_raise_female': { name: "High Knees", angle: "Standing", instructions: "March in place, lifting knees high.", key: 'standing_knee_raise_female', muscle: "Cardio", duration: 60 },
                   'bird_dog_female': { name: "Bird Dog", angle: "Floor", instructions: "Extend opposite arm and leg.", key: 'bird_dog_female', muscle: "Core Stability", duration: 45 },
                   'dead_bug_female': { name: "Dead Bug", angle: "Floor", instructions: "Lower opposite arm/leg, keep back flat.", key: 'dead_bug_female', muscle: "Deep Core", duration: 45 },
                   'pelvic_tilts_female': { name: "Pelvic Tilts", angle: "Floor", instructions: "Tilt pelvis to flatten lower back.", key: 'pelvic_tilts_female', muscle: "Core", duration: 45 },
                   
                   'cat_cow_female': { name: "Cat Cow", angle: "Floor", instructions: "Arch and round spine gently.", key: 'cat_cow_female', muscle: "Mobility", duration: 60 },
                   'childs_pose_female': { name: "Child's Pose", angle: "Floor", instructions: "Sit back on heels, reach forward.", key: 'childs_pose_female', muscle: "Stretch", duration: 60 },
                   'scapular_slides_female': { name: "Wall Slides", angle: "Wall", instructions: "Back to wall, slide arms in 'W'.", key: 'scapular_slides_female', muscle: "Posture", duration: 45 },
                   
                   'lunges_female': { name: "Walking Lunges", angle: "Standing", instructions: "Step forward, lower back knee.", key: 'lunges_female', muscle: "Legs", duration: 45 },
                   'wall_sit_female': { name: "Wall Sit", angle: "Wall", instructions: "Sit against wall, knees at 90째.", key: 'wall_sit_female', muscle: "Quads", duration: 45 },
                   'clamshells_female': { name: "Clamshells", angle: "Floor", instructions: "Side lying, open top knee.", key: 'clamshells_female', muscle: "Hips/Glutes", duration: 45 },

                   'romanian_deadlift_female': { name: "Romanian Deadlift", angle: "Standing", instructions: "Hinge hips back, back straight.", key: 'romanian_deadlift_female', muscle: "Hamstring/Glute", duration: 45 },
                   'donkey_kicks_female': { name: "Donkey Kicks", angle: "Floor", instructions: "Kick leg back/up.", key: 'donkey_kicks_female', muscle: "Glutes", duration: 45 },
                   'superman_female': { name: "Superman", angle: "Floor", instructions: "Lift arms and legs.", key: 'superman_female', muscle: "Lower Back", duration: 45 },
                   'side_lying_leg_lift_female': { name: "Side Leg Lift", angle: "Floor", instructions: "Lift top leg.", key: 'side_lying_leg_lift_female', muscle: "Hips", duration: 45 },
                   'plank_female': { name: "Plank", angle: "Floor", instructions: "Hold plank position.", key: 'plank_female', muscle: "Core", duration: 60 },
                   'side_plank_female': { name: "Side Plank", angle: "Floor", instructions: "Hold side plank.", key: 'side_plank_female', muscle: "Obliques", duration: 45 },
                   'russian_twists_female': { name: "Russian Twists", angle: "Seated", instructions: "Twist torso.", key: 'russian_twists_female', muscle: "Obliques", duration: 45 },
                   'jumping_jacks_female': { name: "Jumping Jacks", angle: "Standing", instructions: "Jump wide.", key: 'jumping_jacks_female', muscle: "Cardio", duration: 60 },
                   'mountain_climbers_female': { name: "Mountain Climbers", angle: "Floor", instructions: "Drive knees to chest.", key: 'mountain_climbers_female', muscle: "Cardio", duration: 45 },
                   'step_ups_female': { name: "Step Ups", angle: "Standing", instructions: "Step up on box.", key: 'step_ups_female', muscle: "Legs", duration: 60 },
                   'squat_jumps_female': { name: "Squat Jumps", angle: "Standing", instructions: "Squat and jump.", key: 'squat_jumps_female', muscle: "Cardio/Legs", duration: 45 },

                   'cardio_walk': { name: "Rest / Walk", angle: "N/A", instructions: "Active recovery or rest.", key: 'cardio_walk', muscle: "Cardio", duration: 300 }
                },
                protocols: {
                    'Strength A': ['goblet_squat_female', 'kneeling_pushups_female', 'one_arm_row_female', 'overhead_press_female', 'glute_bridges_female'],
                    'Cardio Core': ['standing_knee_raise_female', 'bird_dog_female', 'dead_bug_female', 'pelvic_tilts_female', 'cardio_walk'],
                    'Rest Flow': ['cat_cow_female', 'childs_pose_female', 'scapular_slides_female', 'glute_bridges_female', 'cardio_walk'],
                    'Strength B': ['lunges_female', 'wall_sit_female', 'clamshells_female', 'scapular_slides_female', 'kneeling_pushups_female'],
                    'Strength C': ['romanian_deadlift_female', 'donkey_kicks_female', 'superman_female', 'side_lying_leg_lift_female', 'plank_female'],
                    'Strength D': ['plank_female', 'side_plank_female', 'russian_twists_female', 'bird_dog_female', 'dead_bug_female'],
                    'Strength E': ['jumping_jacks_female', 'mountain_climbers_female', 'step_ups_female', 'squat_jumps_female', 'standing_knee_raise_female'],
                    'Active Rec': ['cardio_walk', 'cat_cow_female', 'childs_pose_female'],
                    'Rest': ['cardio_walk']
                },
                defaultSchedule: ['Strength A', 'Cardio Core', 'Rest Flow', 'Strength B', 'Cardio Core', 'Active Rec', 'Rest']
            }
        };

        function ExerciseVisual({ exerciseKey, assets }) {
            const hasAsset = assets.includes(exerciseKey);

            if (!hasAsset && exerciseKey !== 'cardio_walk') {
               return (
                 <div className="w-full h-full bg-zinc-900 flex flex-col items-center justify-center text-zinc-600 font-mono gap-2 p-4 text-center relative">
                    <Loader2 className="animate-spin" />
                    <span className="text-xs">ASSET NOT FOUND: {exerciseKey}</span>
                 </div>
               );
            }

            // Fallback for cardio
            if (exerciseKey === 'cardio_walk') {
                return (
                     <div className="w-full h-full bg-zinc-900 flex items-center justify-center">
                        <div className="flex flex-col items-center gap-4 animate-pulse">
                            <Clock className="text-lime-500 w-24 h-24" />
                            <span className="text-zinc-500 font-mono text-sm uppercase tracking-widest">Walk Time</span>
                        </div>
                     </div>
                );
            }

            const isFemale = exerciseKey.includes('female');
            // Hacky way to detect file extension, assuming new ones are .png from generation tool usually, 
            // but the original code used .jpg. Let's support both or standardized. 
            // The generated files are .png. The old files were .jpg
            // Implementation: We will use a function or try/catch. Or simpler:
            // Since I know which are which:
            const ext = isFemale ? 'png' : 'jpg';
            // Actually, the original code had .jpg. The new artifacts are .png. 
            // Better to just support png for new ones.

            return (
                <div className="relative w-full h-full flex items-center justify-center bg-black overflow-hidden group">
                     <div className="w-full h-full flex items-center justify-center p-8">
                          <img 
                             src={`assets/infographics/${exerciseKey}.${ext}`} 
                             onError={(e) => {
                                 // Fallback to other extension if needed or show error
                                 if (e.target.src.endsWith('.png')) {
                                     e.target.src = e.target.src.replace('.png', '.jpg');
                                 } else {
                                     e.target.style.display='none'; 
                                     e.target.parentNode.innerText='INFOGRAPHIC MISSING';
                                 }
                             }}
                             className="w-full h-full object-contain border border-lime-500/30 rounded-lg shadow-[0_0_30px_-10px_rgba(132,204,22,0.3)]" 
                             alt="Infographic"
                          />
                     </div>
                </div>
            );
        }

        function App() {
          const [dayIdx] = useState(new Date().getDay());
          
          // Profile State
          const [userProfile, setUserProfile] = useState(() => {
              return localStorage.getItem('mundane_fitness_profile') || 'man';
          });

          // Derived Data based on Profile
          const activeProfileData = PROFILES[userProfile];
          const protocols = activeProfileData.protocols;
          const exerciseLibrary = activeProfileData.library;
          const availableAssets = activeProfileData.assets;
          const activeConfig = activeProfileData.config || { restTime: 45, rounds: 1 }; // Default if missing

          const [schedule, setSchedule] = useState(() => {
            const saved = localStorage.getItem(`mundane_fitness_schedule_${userProfile}`); 
            return saved ? JSON.parse(saved) : activeProfileData.defaultSchedule;
          });

          // Reset schedule if profile changes
          useEffect(() => {
              const saved = localStorage.getItem(`mundane_fitness_schedule_${userProfile}`);
              if (saved) {
                  setSchedule(JSON.parse(saved));
              } else {
                  setSchedule(activeProfileData.defaultSchedule);
              }
          }, [userProfile]);



          const [forceProtocol, setForceProtocol] = useState(null);
          const activeProtocolType = forceProtocol || schedule[dayIdx];
          
          // GENERATE ROUTINE LIST WITH ROUNDS
          const baseRoutineKeys = protocols[activeProtocolType] || protocols['Rest'];
          
          // Flatten routine based on rounds (Except for Rest which is 1 round)
          const activeRoutineKeys = useMemo(() => {
               // Straight Sets: Return unique exercises. Logic handles sets.
               return baseRoutineKeys || [];
          }, [baseRoutineKeys]);

          
          const TARGET_ROUNDS = activeConfig.rounds || 1;
          const EXERCISE_REST = activeConfig.restTime || 60;
          const SET_REST = activeConfig.setRestTime || 10;
          const REST_DURATION = EXERCISE_REST; // Fallback ref

          const [currentStep, setCurrentStep] = useState(0);
          const [currentSet, setCurrentSet] = useState(0);
          const [phase, setPhase] = useState('WORK'); // 'WORK', 'REST_SET', 'REST_EXERCISE'
          
          const [timeLeft, setTimeLeft] = useState(0);
          const [isRunning, setIsRunning] = useState(false);
          const [isResting, setIsResting] = useState(false); 
          const [showSettings, setShowSettings] = useState(false);

          const [isMuted, setIsMuted] = useState(false);
          const audioRef = useRef(null); 
          
          // Ensure voices are loaded and pick English
          const [voice, setVoice] = useState(null);
          
          const selectBestVoice = () => {
              const all = window.speechSynthesis.getVoices();
              // Priority: "Premium" -> "Enhanced" -> "Google" -> Default
              const best = all.find(v => v.name.includes("Premium") && v.lang.startsWith("en")) ||
                           all.find(v => v.name.includes("Enhanced") && v.lang.startsWith("en")) ||
                           all.find(v => v.name.includes("Google") && v.lang.startsWith("en")) ||
                           all.find(v => v.lang.startsWith("en-US")) ||
                           all.find(v => v.lang.startsWith("en"));
              if (best) setVoice(best);
              return best;
          };

          const [debugLog, setDebugLog] = useState([]);
          const addToLog = (msg) => setDebugLog(prev => [msg, ...prev].slice(0, 5));
          const [debugMsgs, setDebugMsgs] = useState([]);

          const addDebug = (msg) => setDebugMsgs(prev => [msg, ...prev].slice(0, 50));

          useEffect(() => {
              const loadVoices = () => {
                  const voices = window.speechSynthesis.getVoices();
                  addDebug(`Voices loaded: ${voices.length}`);
                  
                  if (voices.length > 0) {
                      // Try to find Google US English, or any English, or just the first one
                      const bestVoice = voices.find(v => v.name.includes("Google US English")) || 
                                        voices.find(v => v.lang.startsWith("en")) || 
                                        voices[0];
                      setVoice(bestVoice);
                      addDebug(`Selected: ${bestVoice ? bestVoice.name : 'None'}`);
                  } else {
                      addDebug("No voices found yet.");
                  }
              };

              loadVoices();
              // window.speechSynthesis.onvoiceschanged = loadVoices; // DISABLED: Preventing Re-render flood
              
              // Try to load voices again after a delay (iOS quirk)
              setTimeout(selectBestVoice, 1000);
              
              // Fallback: Retry every second for 5 seconds if no voices
              const i = setInterval(() => {
                  if (window.speechSynthesis.getVoices().length === 0) loadVoices();
                  else clearInterval(i);
              }, 1000);
              
              return () => clearInterval(i);
          }, []);

          // Playlist Definition
          // Playlist: Using reliable test URLs to avoid NotSupportedError
          const PLAYLIST = [
              { url: 'https://cdn.pixabay.com/download/audio/2022/05/27/audio_1808fbf07a.mp3', title: "Ethereal Flow", artist: "Pixabay" },
              { url: 'https://cdn.pixabay.com/download/audio/2022/11/22/audio_febc508520.mp3', title: "Power Pulse", artist: "Pixabay" },
              { url: 'https://cdn.pixabay.com/download/audio/2022/03/24/audio_34b79bcf95.mp3', title: "Deep Focus", artist: "Pixabay" },
              { url: 'https://cdn.pixabay.com/download/audio/2022/01/18/audio_d0a13f69d2.mp3', title: "Night Run", artist: "Pixabay" },
              
          ];

          const [playlist, setPlaylist] = useState(() => {
              // Fisher-Yates Shuffle on init
              const list = [...PLAYLIST];
              for (let i = list.length - 1; i > 0; i--) {
                  const j = Math.floor(Math.random() * (i + 1));
                  [list[i], list[j]] = [list[j], list[i]];
              }
              return list;
          });
          const [currentTrackIdx, setCurrentTrackIdx] = useState(0);

          // Audio Logic
          useEffect(() => {
              if (audioRef.current) {
                  // Only change source if the track index actually changed or it's first load
                  const currentSrc = audioRef.current.getAttribute('src');
                  const nextSrc = playlist[currentTrackIdx].url;
                  
                  if (currentSrc !== nextSrc) {
                      audioRef.current.src = nextSrc;
                      if (isRunning && !isMuted) {
                          audioRef.current.play().catch(e => console.log("Audio play failed:", e));
                      }
                  } else {
                      // Same source, just toggle play state
                      if (isRunning && !isMuted) {
                          audioRef.current.play().catch(e => console.log("Audio play failed:", e));
                      } else {
                          audioRef.current.pause();
                      }
                  }
              }
          }, [isRunning, isMuted, currentTrackIdx]); 
          
          const nextTrack = () => {
              setCurrentTrackIdx(prev => (prev + 1) % playlist.length);
          };

          const prevTrack = () => {
              setCurrentTrackIdx(prev => (prev - 1 + playlist.length) % playlist.length);
          };

          const shufflePlaylist = () => {
              setPlaylist(prev => {
                  const list = [...prev];
                  for (let i = list.length - 1; i > 0; i--) {
                      const j = Math.floor(Math.random() * (i + 1));
                      [list[i], list[j]] = [list[j], list[i]];
                  }
                  return list;
              });
              setCurrentTrackIdx(0); // Reset to first song of new order
          };

          const [isSidebarOpen, setIsSidebarOpen] = useState(false);


          // Re-trigger play if muted toggled while running
          useEffect(() => {
             if(audioRef.current) {
                 audioRef.current.volume = 0.3; // Set default volume to 30%
             }
          }, []);

          // Main Timer Loop

          // Helper for current exercise duration
          useEffect(() => {
              if (phase === 'WORK' && !isRunning && timeLeft === 0) {
                  // Initialize time for new step/set
                  const key = activeRoutineKeys[currentStep];
                  if (key) {
                      setTimeLeft(exerciseLibrary[key]?.duration || 45);
                  }
              }
          }, [currentStep, phase, activeRoutineKeys, isRunning]);

          // Main Timer Loop
          useEffect(() => {
            let interval = null;
            if (isRunning && timeLeft > 0) {
              interval = setInterval(() => {
                  setTimeLeft(prev => {
                      const newValue = prev - 1;
                      if ([3, 2, 1].includes(newValue)) speak(["One", "Two", "Three"][3 - newValue]);
                      return newValue;
                  });
              }, 1000);
            } else if (timeLeft === 0 && isRunning) {
               // PHASE TRANSITION LOGIC
               if (phase === 'WORK') {
                   playBeep();
                   if (currentSet < TARGET_ROUNDS - 1) {
                       // Go to SET REST
                       setPhase('REST_SET');
                       setIsResting(true);
                       setTimeLeft(SET_REST);
                       speak("Rest.");
                   } else {
                       // Done with all sets -> Go to EXERCISE REST (or Finish)
                       if (currentStep < activeRoutineKeys.length - 1) {
                           setPhase('REST_EXERCISE');
                           setIsResting(true);
                           setTimeLeft(EXERCISE_REST);
                           const nextName = exerciseLibrary[activeRoutineKeys[currentStep + 1]]?.name || "Next Exercise";
                           speak(`Exercise usage complete. Recover. Next up: ${nextName}`);
                       } else {
                           finishWorkout();
                       }
                   }
               } else if (phase === 'REST_SET') {
                   // Back to Work (Next Set)
                   playBeep();
                   setCurrentSet(prev => prev + 1);
                   setPhase('WORK');
                   setIsResting(false);
                   const exDuration = exerciseLibrary[activeRoutineKeys[currentStep]]?.duration || 45;
                   setTimeLeft(exDuration);
                   speak(`Set ${currentSet + 2}`);
               } else if (phase === 'REST_EXERCISE') {
                   // Next Exercise
                   playBeep();
                   setCurrentStep(prev => prev + 1);
                   setCurrentSet(0);
                   setPhase('WORK');
                   setIsResting(false);
                   const nextKey = activeRoutineKeys[currentStep + 1];
                   if (nextKey) {
                       const ex = exerciseLibrary[nextKey];
                       setTimeLeft(ex.duration);
                       speak(ex.name);
                   }
               }
            }
            return () => clearInterval(interval);
          }, [isRunning, timeLeft, phase, currentSet, currentStep, TARGET_ROUNDS, activeRoutineKeys]);

          const finishWorkout = () => {
              setIsRunning(false);
              speak("Great job! Workout complete.");
          };

          const handleStepComplete = () => {
              // Manual Advance (Skip)
              if (currentStep < activeRoutineKeys.length - 1) {
                  if (isResting) {
                      // Skip Rest -> Go to Work
                      setIsResting(false);
                      setCurrentStep(prev => prev + 1);
                      const nextKey = activeRoutineKeys[currentStep + 1];
                      const nextEx = exerciseLibrary[nextKey];
                      setTimeLeft(nextEx.duration);
                  } else {
                      // Skip Work -> Go to Next Work (Skip rest too? Or go to rest?)
                      // User interaction implies "Done with this", lets go to Rest
                      setIsResting(true);
                      setTimeLeft(REST_DURATION);
                  }
              } else {
                  finishWorkout();
              }
          };
          
          const skipStep = () => {
              handleStepComplete();
          };



          // Simplified "User Snippet" style speak with beep
          const speak = (text) => {
              // 1. Always Beep (it works)
              playBeep();
              
              // 2. Simple Speak
              const synth = window.speechSynthesis;
              synth.cancel(); // Always clear pending to prevent queue pileup

              const u = new SpeechSynthesisUtterance(text);
              u.volume = 1.0;
              u.rate = 1.0; // Normal rate
              if (voice) u.voice = voice; // Use the "Premium" voice we found

              // Music Ducking
              if (audioRef.current && isRunning && !isMuted) {
                   audioRef.current.volume = 0.1;
              }
              
              u.onend = () => {
                   window._lastUtterance = null;
                   addToLog("Speak: End");
                   if (audioRef.current && isRunning && !isMuted) {
                        // Restore volume gently
                        audioRef.current.volume = 0.3;
                   }
              }
              u.onstart = () => addToLog(`Speak: Start (${text.substring(0,8)}...)`);
              u.onerror = (e) => addToLog(`Speak: Err ${e.error}`);
              
              window._lastUtterance = u; // CRITICAL: PREVENT GC
              synth.speak(u);
          };
          
          const toggleWorkout = () => {
              if (!isRunning) {
                  if (timeLeft <= 0) {
                      const ex = exerciseLibrary[activeRoutineKeys[currentStep]];
                      if (ex) setTimeLeft(ex.duration);
                  }
                  
                  // Resume context (CRITICAL FOR iOS)
                  window.speechSynthesis.resume();
                  
                  // Ensure we have a clean slate
                  if (window._audioDisabled) {
                      // Do nothing (Debug mode)
                  } else if (audioRef.current && !isMuted) {
                      audioRef.current.play().catch(e => console.log("Audio resume failed", e));
                  }
                  
                  speak("Starting session.");
              } else {
                  // Pausing
                  window.speechSynthesis.cancel();
                  if (audioRef.current) audioRef.current.pause();
              }
              setIsRunning(!isRunning);
          };
          
          // Safety Beep using Web Audio API (Fallback)
          const playBeep = () => {
              try {
                  const ctx = new (window.AudioContext || window.webkitAudioContext)();
                  const osc = ctx.createOscillator();
                  const gain = ctx.createGain();
                  osc.connect(gain);
                  gain.connect(ctx.destination);
                  osc.frequency.value = 880; // High beep
                  gain.gain.value = 0.1;
                  osc.start();
                  setTimeout(() => {
                      osc.stop();
                      ctx.close();
                  }, 200);
                  addDebug("Beep played");
              } catch (e) {
                  addDebug(`Beep failed: ${e}`);
              }
          };

          const testVoiceBasic = () => {
              addDebug("Test: Basic (Window Store)");
              playBeep(); // Prove audio context works
              
              window.speechSynthesis.cancel();
              const u = new SpeechSynthesisUtterance("Testing.");
              u.volume = 1.0;
              u.onstart = () => addDebug("Event: Start");
              u.onend = () => addDebug("Event: End");
              u.onerror = (e) => addDebug(`Event: Err ${e.error}`);
              
              // GLOBAL STORAGE TO PREVENT GC
              window._lastUtterance = u;
              
              window.speechSynthesis.speak(u);
          };

          const testVoiceForced = () => {
              addDebug("Test: Forced (Window Store)");
              const s = window.speechSynthesis;
              s.cancel();
              s.resume();
              
              const u = new SpeechSynthesisUtterance("Forced test.");
              // Don't set voice - let browser default
              u.onstart = () => addDebug("Event: Start");
              u.onerror = (e) => addDebug(`Event: Err ${e.error}`);
              
              window._lastUtterance = u;
              s.speak(u);
          };
          
          const testVoiceDirect = () => {
              addDebug("Test: Direct (Reset+Speak)");
              window.speechSynthesis.cancel();
              
              const u = new SpeechSynthesisUtterance("Direct.");
              window._lastUtterance = u;
              window.speechSynthesis.speak(u);
          };

          const handlePreview = (index) => {
              if (isRunning) return; 
              setCurrentStep(index);
              setIsResting(false); 
              // Immediate time update
              const ex = exerciseLibrary[activeRoutineKeys[index]];
              if (ex) setTimeLeft(ex.duration);
          };

          const shuffleRoutine = () => {
              const allKeys = Object.keys(protocols).filter(k => k !== 'Rest');
              // Basic safety if no keys
              if (allKeys.length === 0) return;

              let next = activeProtocolType;
              // Try to pick a new one, avoid infinite loop if only 1 exists
              if (allKeys.length > 1) {
                  while (next === activeProtocolType || next === 'Rest') {
                      next = allKeys[Math.floor(Math.random() * allKeys.length)];
                  }
              } else {
                  next = allKeys[0];
              }
              
              setForceProtocol(next);
              
              // Reset State
              setIsRunning(false);
              setIsResting(false);
              setCurrentStep(0);
              
              // Set time for new first exercise
              const firstKey = protocols[next][0];
              if (firstKey && exerciseLibrary[firstKey]) {
                  setTimeLeft(exerciseLibrary[firstKey].duration);
              }
              
              speak(`Switched to ${next}`);
          };

          const formatTime = (s) => {
            const min = Math.floor(s / 60);
            const sec = s % 60;
            return `${min}:${sec.toString().padStart(2, '0')}`;
          };

          const currentKey = activeRoutineKeys[currentStep];
          const currentEx = exerciseLibrary[currentKey] || exerciseLibrary['cardio_walk']; 
          
          // Determine Next Exercise for Display
          const nextKeyDisplay = (currentStep < activeRoutineKeys.length - 1) ? activeRoutineKeys[currentStep + 1] : null;
          const nextExDisplay = nextKeyDisplay ? exerciseLibrary[nextKeyDisplay] : null;

          return (
            <div className="min-h-screen bg-[#050505] text-white font-sans flex flex-col h-screen overflow-hidden">
              <audio 
                ref={audioRef} 
                onEnded={nextTrack}
              />

              {/* TOP NAV is now simplified */}
              <div className="flex items-center justify-between px-6 py-4 border-b border-white/10 shrink-0 bg-[#050505]/90 backdrop-blur z-20">
                <div className="flex items-center gap-4">
                  <Dumbbell className="text-lime-500 w-6 h-6" />
                  <h1 className="text-xl font-bold tracking-tight bg-gradient-to-r from-lime-400 to-lime-600 bg-clip-text text-transparent">
                    MUNDANE FITNESS
                  </h1>
                </div>
                
                <button 
                  onClick={() => setIsSidebarOpen(true)}
                  className="p-2 text-zinc-400 hover:text-white transition-colors"
                >
                  <Menu className="w-6 h-6" />
                </button>
              </div>

              {/* MAIN CONTENT GRID */}
              <div className="flex-1 flex overflow-hidden">
                
                {/* LEFT: VISUAL & TIMER */}
                <div className="flex-[3] relative border-r border-white/10 flex flex-col overflow-hidden">
                   {/* EXERCISE VISUAL */}
                   <div className="flex-1 relative overflow-hidden bg-gradient-to-br from-zinc-900 via-black to-zinc-900 flex items-center justify-center p-4 lg:p-10">
                      {/* BG Grid */}
                      <div className="absolute inset-0 bg-[linear-gradient(rgba(20,20,20,0.5)_1px,transparent_1px),linear-gradient(90deg,rgba(20,20,20,0.5)_1px,transparent_1px)] bg-[size:40px_40px] opacity-20 pointer-events-none"></div>
                      
                      {/* Main Visual - Maximized */}
                      <div className="w-full h-full relative z-10 transition-all duration-500 flex items-center justify-center">
                          <ExerciseVisual exerciseKey={currentKey} assets={availableAssets} />
                      </div>

                      {/* REST OVERLAY */}
                      {isResting && (
                          <div className="absolute inset-0 bg-black/80 backdrop-blur-sm z-20 flex items-center justify-center">
                              <div className="flex flex-col items-center gap-6 animate-in fade-in zoom-in duration-300">
                                  <Clock className="w-20 h-20 text-lime-500 animate-pulse" />
                                  <div className="text-center">
                                      <h2 className="text-4xl font-black text-white mb-2">
                                          {phase === 'REST_SET' ? 'REST' : 'RECOVER'}
                                      </h2>
                                      <p className="text-zinc-400 font-mono text-lg">
                                          {phase === 'REST_SET' ? 'Brief Pause' : 'Next Exercise Coming Up'}
                                      </p>
                                  </div>
                                  <div className="text-8xl font-black font-mono text-lime-400 tabular-nums">
                                      {timeLeft}
                                  </div>
                              </div>
                          </div>
                      )}
                   </div>

                   {/* BOTTOM CONTROL BAR */}
                   <div className="min-h-32 border-t border-white/10 bg-zinc-900/50 backdrop-blur flex items-center px-6 lg:px-10 gap-6 lg:gap-10 shrink-0">
                       
                       {/* Play/Pause */}
                       <button 
                         onClick={toggleWorkout}
                         className={`w-16 h-16 lg:w-20 lg:h-20 flex items-center justify-center rounded-full transition-all shadow-xl hover:scale-105 active:scale-95 shrink-0 ${
                             isRunning 
                             ? 'bg-zinc-800 text-red-400 hover:bg-zinc-700 border-2 border-red-500/20' 
                             : 'bg-lime-500 text-black hover:bg-lime-400 shadow-[0_0_40px_-10px_rgba(132,204,22,0.5)]'
                         }`}
                       >
                           {isRunning ? <Pause className="w-6 h-6 lg:w-8 lg:h-8 fill-current" /> : <Play className="w-6 h-6 lg:w-8 lg:h-8 fill-current ml-1" />}
                       </button>

                       {/* Time & Sets Info */}
                       <div className="flex-1 flex justify-between items-center bg-black/40 rounded-2xl p-4 lg:p-6 border border-white/5 overflow-hidden">
                           
                           <div className="flex flex-col gap-1 min-w-0">
                               <div className="flex items-center gap-3">
                                   <span className="text-[10px] lg:text-xs font-mono text-lime-500 uppercase tracking-widest bg-lime-500/10 px-2 py-1 rounded whitespace-nowrap">
                                       {activeProtocolType}
                                   </span>
                                   {isResting && (
                                       <span className="text-[10px] lg:text-xs font-mono text-amber-500 uppercase tracking-widest bg-amber-500/10 px-2 py-1 rounded whitespace-nowrap">
                                           {phase === 'REST_SET' ? 'SET BREAK' : 'REST'}
                                       </span>
                                   )}
                               </div>
                               <h2 className="text-xl lg:text-3xl font-bold truncate text-white max-w-[150px] lg:max-w-md">
                                   {currentEx.name}
                               </h2>
                           </div>

                           {/* SET COUNTER */}
                           <div className="flex flex-col items-center px-4 lg:px-6 border-l border-r border-white/10 hidden md:flex">
                               <div className="text-[10px] lg:text-xs text-zinc-500 uppercase tracking-wider font-mono mb-1">SET</div>
                               <div className="text-2xl lg:text-3xl font-black font-mono text-white">
                                   {currentSet + 1}<span className="text-zinc-600 text-lg lg:text-xl font-medium">/{TARGET_ROUNDS}</span>
                               </div>
                           </div>

                           {/* TIMER */}
                           <div className="flex flex-col items-end min-w-[80px] lg:min-w-[120px]">
                               <div className="text-[10px] lg:text-xs text-zinc-500 uppercase tracking-wider font-mono mb-1">TIME</div>
                               <div className={`text-3xl lg:text-5xl font-black font-mono tracking-tighter tabular-nums ${timeLeft <= 5 && isRunning ? 'text-red-500 animate-pulse' : 'text-lime-400'}`}>
                                   {formatTime(timeLeft)}
                               </div>
                           </div>
                       </div>

                       {/* Skip Button */}
                       <button onClick={skipStep} className="p-4 rounded-xl hover:bg-white/5 text-zinc-500 hover:text-white transition-colors group hidden md:block">
                           <SkipForward className="w-6 h-6 lg:w-8 lg:h-8 group-hover:translate-x-1 transition-transform" />
                       </button>
                   </div>
                </div>

                {/* RIGHT: WORKOUT LIST */}
                 {/* RIGHT PANEL REMOVED - CONTENT MOVED TO SIDEBAR */}

              </div>

              {/* SIDEBAR */}
              <div aria-label="Sidebar Overlay">
                {isSidebarOpen && (
                  <div 
                    className="fixed inset-0 bg-black/80 backdrop-blur-sm z-40 transition-opacity" 
                    onClick={() => setIsSidebarOpen(false)}
                  />
                )}
                
                <div className={`fixed inset-y-0 right-0 w-80 sm:w-96 bg-[#0a0a0a] border-l border-white/10 z-50 transform transition-transform duration-300 ease-in-out flex flex-col ${isSidebarOpen ? 'translate-x-0' : 'translate-x-full'}`}>
                   {/* Sidebar Header */}
                   <div className="p-6 border-b border-white/10 flex items-center justify-between bg-[#0a0a0a]/90 backdrop-blur shrink-0 sticky top-0 z-20">
                      <h2 className="text-lg font-bold text-white tracking-widest flex items-center gap-2">
                          <Settings className="w-5 h-5 text-lime-500" />
                          CONTROLS
                      </h2>
                      <button onClick={() => setIsSidebarOpen(false)} className="p-2 -mr-2 text-zinc-400 hover:text-white">
                          <X className="w-6 h-6" />
                      </button>
                   </div>

                   {/* Sidebar Content */}
                   <div className="flex-1 overflow-y-auto p-6 space-y-8">
                       
                       {/* SECTION: AUDIO */}
                       <div className="bg-zinc-900/50 rounded-xl p-4 border border-white/5 space-y-4">
                           <h3 className="text-xs font-mono text-zinc-500 uppercase tracking-widest flex items-center gap-2">
                               <Volume2 className="w-4 h-4" /> AUDIO PLAYER
                           </h3>
                           
                           <div className="flex flex-col gap-4">
                               <div className="flex items-center justify-between">
                                  <div className="overflow-hidden">
                                     <div className="text-sm font-bold text-white truncate">{playlist[currentTrackIdx].title}</div>
                                     <div className="text-xs text-zinc-500 truncate">{playlist[currentTrackIdx].artist}</div>
                                  </div>
                                  <button onClick={() => setIsMuted(!isMuted)} className={`p-2 rounded-full ${isMuted ? 'bg-red-500/20 text-red-400' : 'bg-lime-500/20 text-lime-400'}`}>
                                      {isMuted ? <VolumeX className="w-4 h-4" /> : <Volume2 className="w-4 h-4" />}
                                  </button>
                               </div>
                               
                               <div className="grid grid-cols-4 gap-2">
                                   <button onClick={prevTrack} className="p-3 bg-zinc-900 rounded-lg text-zinc-400 hover:text-white flex justify-center"><SkipBack className="w-5 h-5" /></button>
                                   <button onClick={() => { 
                                       if(audioRef.current) {
                                           if (audioRef.current.paused) audioRef.current.play(); else audioRef.current.pause();
                                       }
                                   }} className="p-3 bg-zinc-900 rounded-lg text-zinc-400 hover:text-white flex justify-center"><Play className="w-5 h-5 fill-current" /></button>
                                   <button onClick={nextTrack} className="p-3 bg-zinc-900 rounded-lg text-zinc-400 hover:text-white flex justify-center"><SkipForward className="w-5 h-5" /></button>
                                   <button onClick={shufflePlaylist} className="p-3 bg-zinc-900 rounded-lg text-zinc-400 hover:text-lime-500 flex justify-center" title="Shuffle Music"><Shuffle className="w-5 h-5" /></button>
                               </div>
                           </div>
                       </div>

                       {/* SECTION: CONFIG PROTOCOL */}
                       <div className="space-y-4">
                           <h3 className="text-xs font-mono text-zinc-500 uppercase tracking-widest">Workout Config</h3>
                           
                           {/* Profile */}
                           <div className="grid grid-cols-2 gap-2 bg-zinc-900 p-1 rounded-lg">
                               <button onClick={() => setUserProfile('man')} className={`py-2 text-sm font-medium rounded ${userProfile === 'man' ? 'bg-zinc-800 text-white shadow' : 'text-zinc-500 hover:text-zinc-300'}`}>Man</button>
                               <button onClick={() => setUserProfile('woman')} className={`py-2 text-sm font-medium rounded ${userProfile === 'woman' ? 'bg-zinc-800 text-white shadow' : 'text-zinc-500 hover:text-zinc-300'}`}>Woman</button>
                           </div>

                           {/* Protocol */}
                           <div className="bg-zinc-900 border border-white/5 rounded-lg p-3">
                               <label className="text-[10px] text-zinc-500 font-mono block mb-1">CURRENT ROUTINE</label>
                               <select 
                                    className="w-full bg-transparent text-white text-sm outline-none"
                                    value={activeProtocolType} 
                                    onChange={(e) => {
                                        setForceProtocol(e.target.value);
                                        setIsRunning(false);
                                        setIsResting(false);
                                        setCurrentStep(0);
                                    }}
                               >
                                  {Object.keys(protocols).filter(k => k !== 'Rest').map(key => (
                                      <option key={key} value={key} className="bg-zinc-900">{key}</option>
                                  ))}
                               </select>
                           </div>

                           <button 
                                onClick={shuffleRoutine}
                                className="w-full py-3 border border-zinc-800 rounded-lg text-zinc-400 hover:text-white hover:border-lime-500/50 transition-all flex items-center justify-center gap-2 text-sm font-mono"
                            >
                                <Shuffle className="w-4 h-4" /> RE-ROLL ROUTINE
                            </button>
                       </div>

                       {/* SECTION: WORKOUT LIST */}
                       <div className="space-y-2">
                           <div className="flex justify-between items-baseline">
                               <h3 className="text-xs font-mono text-zinc-500 uppercase tracking-widest">Workout Structure</h3>
                               <span className="text-[10px] text-zinc-600 font-mono">{activeRoutineKeys.length} STEPS</span>
                           </div>
                           
                           <div className="space-y-1">
                                {activeRoutineKeys.map((key, i) => {
                                    const isActive = i === currentStep;
                                    const ex = exerciseLibrary[key] || { name: key };
                                    return (
                                        <div key={i} onClick={() => handlePreview(i)} className={`p-3 rounded border text-sm cursor-pointer transition-colors ${isActive ? 'bg-zinc-800 border-lime-500/30 text-white' : 'border-transparent text-zinc-500 hover:bg-zinc-900 hover:text-zinc-300'}`}>
                                            <div className="flex gap-2">
                                                <span className="font-mono text-xs opacity-50">{i+1}.</span>
                                                <span className="truncate">{ex.name}</span>
                                            </div>
                                        </div>
                                    )
                                })}
                           </div>
                       </div>
                       
                       {/* SECTION: WEEKLY SCHEDULE settings */}
                        <div className="space-y-4 pt-4 border-t border-white/10">
                              <h3 className="text-xs font-mono text-zinc-500 uppercase tracking-widest">Weekly Schedule ({userProfile})</h3>
                              <div className="grid grid-cols-1 gap-2">
                                  {schedule.map((proto, i) => (
                                      <div key={i} className="flex items-center gap-3 bg-zinc-900/50 p-2 rounded-lg border border-white/5">
                                          <span className="w-8 text-zinc-500 font-mono text-xs">{['Sun','Mon','Tue','Wed','Thu','Fri','Sat'][i]}</span>
                                          <select 
                                             value={proto}
                                             onChange={(e) => {
                                                 const newSchedule = [...schedule];
                                                 newSchedule[i] = e.target.value;
                                                 setSchedule(newSchedule);
                                                 localStorage.setItem(`mundane_fitness_schedule_${userProfile}`, JSON.stringify(newSchedule));
                                             }}
                                             className="flex-1 bg-transparent text-zinc-300 text-xs rounded outline-none"
                                          >
                                              {Object.keys(protocols).map(k => <option key={k} value={k} className="bg-zinc-900">{k}</option>)}
                                          </select>
                                      </div>
                                  ))}
                              </div>
                          </div>

                   </div>
                </div>
              </div>
            </div>
          );

        }

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
